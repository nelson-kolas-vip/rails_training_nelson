<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

<style>
  /* Custom Styles */
  body {
    background-color: #f8f9fa;
  }

  .restaurant-title-effect {
    transition: all 0.3s ease-in-out;
  }

  .restaurant-title-effect:hover {
    transform: translateY(-3px);
    text-shadow: 0 4px 12px rgba(0,0,0,0.15);
  }

  .card {
    border: none;
    border-radius: 1rem;
    overflow: hidden;
    transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
  }

  .card:hover {
    transform: translateY(-10px);
    box-shadow: 0 10px 20px rgba(0,0,0,0.1);
  }

  .card-body h5.card-title i {
    transition: transform 0.3s ease-in-out;
  }

  .card:hover h5.card-title i {
    transform: rotate(10deg);
  }

  .card-footer {
    padding: 1rem 1.5rem;
  }

  /* Buttons Styling */
  .btn-group {
    display: flex;
    width: 100%;
  }

  .btn-group .btn {
    flex-grow: 1;
    border-radius: 0;
    font-weight: 600;
    padding: 0.3rem 0;
    font-size: 0.9rem;
    text-align: center;
    transition: all 0.2s ease-in-out;
  }

  .btn-group .btn:first-child {
    border-top-left-radius: 0.5rem;
    border-bottom-left-radius: 0.5rem;
  }

  .btn-group .btn:last-child {
    border-top-right-radius: 0.5rem;
    border-bottom-right-radius: 0.5rem;
  }

  .btn-group .btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  }

  /* Button Colors */
  .btn-outline-primary {
    color: #0d6efd;
    border-color: #0d6efd;
  }

  .btn-outline-primary:hover {
    background-color: #0d6efd;
    color: #fff;
  }

  .btn-outline-success {
    color: #198754;
    border-color: #198754;
  }

  .btn-outline-success:hover {
    background-color: #198754;
    color: #fff;
  }

  .btn-outline-info {
    color: #0dcaf0;
    border-color: #0dcaf0;
  }

  .btn-outline-info:hover {
    background-color: #0dcaf0;
    color: #fff;
  }

  .btn-outline-danger {
    color: #dc3545;
    border-color: #dc3545;
  }

  .btn-outline-danger:hover {
    background-color: #dc3545;
    color: #fff;
  }

  /* Icon Colors */
  .icon-location { color: #dc3545; }
  .icon-cuisine { color: #ffc107; }
  .icon-description { color: #6c757d; }

  /* Custom Dropdown for Sorting */
  .dropdown-toggle::after {
    display: none;
  }

  /* Custom Pagination Styling */
  .pagination {
    display: flex;
    justify-content: center;
    padding-left: 0;
    list-style: none;
    border-radius: 0.25rem;
  }

  .pagination a, .pagination em {
    position: relative;
    display: block;
    padding: 0.5rem 0.75rem;
    margin-left: -1px;
    line-height: 1.25;
    color: #007bff;
    background-color: #fff;
    border: 1px solid #dee2e6;
    text-decoration: none;
    transition: all 0.3s;
  }

  .pagination a:hover {
    background-color: #e9ecef;
    border-color: #dee2e6;
  }

  .pagination .current {
    z-index: 2;
    color: #fff;
    background-color: #007bff;
    border-color: #007bff;
  }

  .pagination .current:hover {
    color: #fff;
    background-color: #007bff;
  }

  .pagination .disabled {
    color: #6c757d;
    pointer-events: none;
    background-color: #fff;
    border-color: #dee2e6;
  }

  .pagination .first, .pagination .last {
    border-radius: 0.25rem;
  }

  .pagination .first {
    border-top-right-radius: 0;
    border-bottom-right-radius: 0;
  }

  .pagination .last {
    border-top-left-radius: 0;
    border-bottom-left-radius: 0;
  }

  .pagination .prev, .pagination .next {
    border-radius: 0;
  }
</style>

<div class="container py-5">
  <div class="d-flex justify-content-between align-items-center mb-5">
    <h1 class="display-5 fw-bold restaurant-title-effect mb-0">
      <i class="bi bi-shop-window text-info me-2"></i>
      Explore Restaurants
    </h1>

    <div class="dropdown">
  <button class="btn btn-outline-primary dropdown-toggle" type="button" id="sortDropdown" data-bs-toggle="dropdown" aria-expanded="false">
    Sort By
    <i class="bi bi-sort-down-alt ms-2"></i>
  </button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="sortDropdown">
    <li>
      <%= link_to 'Name', restaurants_path(sort: 'name', page: params[:page]), class: "dropdown-item #{'active' if params[:sort] == 'name'}" %>
    </li>
    <li>
      <%= link_to 'Rating', restaurants_path(sort: 'rating', page: params[:page]), class: "dropdown-item #{'active' if params[:sort] == 'rating'}" %>
    </li>
  </ul>
</div>
  </div>

  <% if @restaurants.blank? %>
    <div class="alert alert-info text-center" role="alert">
      <i class="bi bi-info-circle-fill me-2"></i>
      No restaurants found.
      <%= link_to "Create one now", new_restaurant_path, class: "text-decoration-underline fw-semibold" %>
    </div>
  <% else %>
    <div class="row g-4">
      <% @restaurants.each do |r| %>
        <div class="col-sm-12 col-md-6 col-lg-6">
          <div class="card h-100 shadow">
            <div class="card-body d-flex flex-column">
              <h5 class="card-title text-dark mb-3">
                <i class="bi bi-shop me-2 text-dark"></i>
                <%= r.name.presence || "Unnamed Restaurant" %>
              </h5>

              <div class="mb-2">
                <i class="bi bi-geo-alt-fill me-2 icon-location"></i>
                <strong>Location:</strong>
                <%= r.location.presence || "Not specified" %>
              </div>

              <div class="mb-2">
                <i class="bi bi-egg-fried me-2 icon-cuisine"></i>
                <strong>Cuisine:</strong>
                <%= r.cuisine_type.presence || "Not specified" %>
              </div>

              <div class="mb-2">
                <i class="bi bi-star-fill me-2" style="color: gold;"></i>
                <strong>Rating:</strong>
                <%= r.rating ? "%.1f" % r.rating : "N/A" %>
              </div>

              <div class="text-secondary mt-auto">
                <i class="bi bi-card-text me-2 icon-description"></i>
                <%= truncate(r.description.to_s, length: 100) %>
              </div>
            </div>

            <div class="card-footer bg-white border-0">
              <div class="d-flex flex-wrap gap-2 justify-content-center">
                <% if current_user&.staff? %>
                  <%= link_to restaurant_tables_path(r), class: "btn btn-sm btn-outline-dark" do %>
                    <i class="bi bi-bounding-box"></i> Tables
                  <% end %>
                  <%= link_to restaurant_reservations_path(r), class: "btn btn-sm btn-outline-dark" do %>
                    <i class="bi bi-calendar-check me-1"></i> Reservations
                  <% end %>
                <% elsif current_user&.customer? %>
                  <%= link_to my_reserved_tables_path(restaurant_id: r), class: "btn btn-sm btn-outline-success" do %>
                    <i class="bi bi-bookmark-star-fill me-1"></i> My Reservations
                  <% end %>
                  <%= link_to restaurant_tables_path(r), class: "btn btn-sm btn-outline-primary" do %>
                    <i class="bi bi-door-open me-1"></i> View
                  <% end %>
                  <%= link_to new_restaurant_feedback_path(r, previous_url: request.original_url), class: "btn btn-sm btn-outline-secondary" do %>
                    <i class="bi bi-chat-left-text me-1"></i> Write Feedback
                  <% end %>
                <% end %>

                <%= link_to restaurant_menus_path(r), class: "btn btn-sm btn-outline-primary" do %>
                  <i class="bi bi-journal-text me-1"></i> Menu
                <% end %>
              </div>
            </div>
          </div>
        </div>
      <% end %>
    </div>

    <div class="d-flex justify-content-center mt-4">
      <%= will_paginate @restaurants %>
    </div>
  <% end %>
</div>